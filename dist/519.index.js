"use strict";(self.webpackChunkjjdd_huatu=self.webpackChunkjjdd_huatu||[]).push([[519],{519:(e,t,s)=>{s.r(t),s.d(t,{default:()=>C});var a=s(540),i=s(169),l=s(692),n=s(932),r=s(848);const o=function(){const{state:e,dispatch:t,actionTypes:s,refreshStamina:o}=(0,i.oi)(),{activeHeader:c,stamina:d,apiKey:h}=e,[u,p]=(0,a.useState)(!1);(0,a.useEffect)((()=>{const e=localStorage.getItem("jjddHuatuSettings");if(e)try{const a=JSON.parse(e);a&&a.activeHeader&&t({type:s.SET_ACTIVE_HEADER,payload:a.activeHeader})}catch(e){console.error("解析标题栏设置出错:",e),t({type:s.SET_ACTIVE_HEADER,payload:"default"})}}),[t,s]),(0,a.useEffect)((()=>{h&&"stamina"===c&&m()}),[h]),(0,a.useEffect)((()=>{"stamina"===c&&h&&m()}),[c]);const m=async()=>{if(h){p(!0);try{const e=await(0,l.qI)(h);t({type:s.UPDATE_STAMINA,payload:{used:e.used||0,total:e.total||1e4,lastUpdate:(new Date).toISOString()}}),console.log("体力信息更新成功",e)}catch(e){console.error("获取体力信息失败:",e),(0,n.P0)(`获取体力信息失败: ${e.message}`,3e3,!0),t({type:s.UPDATE_STAMINA,payload:{used:0,total:1e4}})}finally{p(!1)}}else(0,n.P0)("未设置API密钥，无法获取体力信息",3e3,!0)},x=d?.used||0,j=d?.total||1e4,g=Math.max(0,Math.min(100,x/j*100)),v=d?.lastUpdate?`最后更新: ${new Date(d.lastUpdate).toLocaleString()}`:"";return(0,r.jsxs)("div",{className:"switchable-header",children:[(0,r.jsxs)("div",{className:"header-default "+("default"===c?"active":""),children:[(0,r.jsx)("button",{className:"triangle-button left-triangle",title:"切换到体力值显示",onClick:()=>{t({type:s.SET_ACTIVE_HEADER,payload:"stamina"}),m()},children:(0,r.jsx)("i",{className:"fas fa-caret-left"})}),(0,r.jsx)("h3",{children:"简单画图"})]}),(0,r.jsx)("div",{className:"header-stamina "+("stamina"===c?"active":""),children:(0,r.jsxs)("div",{className:"stamina-container",children:[(0,r.jsxs)("div",{className:"stamina-top",children:[(0,r.jsxs)("div",{className:"stamina-header-group",children:[(0,r.jsx)("button",{className:"triangle-button right-triangle",title:"切换到简单画图",onClick:()=>{t({type:s.SET_ACTIVE_HEADER,payload:"default"})},children:(0,r.jsx)("i",{className:"fas fa-caret-right"})}),(0,r.jsx)("span",{className:"stamina-label",children:"已用体力"})]}),(0,r.jsxs)("div",{className:"stamina-inputs",children:[(0,r.jsx)("span",{id:"used-stamina",className:"stamina-text used-stamina",children:x}),(0,r.jsx)("span",{className:"stamina-separator",children:"/"}),(0,r.jsx)("span",{id:"total-stamina",className:"stamina-text total-stamina",children:j})]}),(0,r.jsx)("button",{className:"refresh-stamina",title:"刷新体力信息",onClick:e=>{e.stopPropagation(),m()},disabled:u,children:(0,r.jsx)("i",{className:"fas fa-sync-alt "+(u?"fa-spin":"")})})]}),(0,r.jsx)("div",{className:"stamina-wrapper",children:(0,r.jsx)("div",{className:"stamina-progress-container",children:(0,r.jsx)("div",{className:"stamina-progress-bar",id:"stamina-progress-bar",style:{width:`${g}%`}})})}),v&&(0,r.jsx)("div",{className:"stamina-update-time",children:v})]})})]})};const c=function(e){let{id:t,label:s,isActive:a,onClick:i,icon:l=null}=e;return(0,r.jsxs)("button",{className:"tab-button "+(a?"active":""),"data-tab":t,onClick:i,title:s,children:[l&&(0,r.jsx)("i",{className:`tab-icon ${l}`}),(0,r.jsx)("span",{className:"tab-label",children:s})]})};const d=function(e){let{isActive:t,id:s,children:i,fallbackForEmpty:l=!1,title:n="标签页"}=e;return t?(0,r.jsx)("div",{id:`${s}-tab`,className:"tab-content active",children:(0,r.jsx)(a.Suspense,{fallback:(0,r.jsx)("div",{className:"loading-placeholder",children:"加载中..."}),children:i||l&&(0,r.jsx)("div",{className:"empty-tab-placeholder",children:(0,r.jsxs)("div",{className:"placeholder-content",children:[(0,r.jsxs)("h3",{children:[n,"功能正在开发中"]}),(0,r.jsx)("p",{children:"此功能将在后续版本中实现，敬请期待！"})]})})})}):null};const h=function(e){let{tabs:t,activeTab:s,setActiveTab:i,className:l=""}=e;return(0,a.useEffect)((()=>{try{const e=localStorage.getItem("jjdd_huatu_last_tab");e&&t.some((t=>t.id===e))&&i(e)}catch(e){console.warn("无法恢复上次使用的标签页:",e)}}),[]),(0,r.jsxs)("div",{className:`tab-container ${l}`,children:[(0,r.jsx)("div",{className:"tab-buttons",children:t.map((e=>(0,r.jsx)(c,{id:e.id,label:e.label,icon:e.icon,isActive:s===e.id,onClick:()=>(e=>{i(e);try{localStorage.setItem("jjdd_huatu_last_tab",e)}catch(e){console.warn("无法保存最后使用的标签页:",e)}})(e.id)},e.id)))}),(0,r.jsx)("div",{className:"tab-contents",children:t.map((e=>(0,r.jsx)(d,{id:e.id,isActive:s===e.id,title:e.label,fallbackForEmpty:!e.content,children:e.content},e.id)))})]})};var u=s(106),p=s(706);const m=function(e){let{onError:t}=e;const{state:s,dispatch:l,actionTypes:n}=(0,i.oi)(),{model:o,upscaler:c}=s,d=(0,u.B)(),h=(0,a.useRef)(null),[m,x]=(0,a.useState)(!1);return(0,r.jsxs)("div",{className:"model-selector",children:[(0,r.jsxs)("div",{className:"model-header",style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"},children:[(0,r.jsx)("label",{style:{marginRight:"10px"},children:"选择模型:"}),(0,r.jsxs)("div",{className:"model-toggle",style:{display:"flex",alignItems:"center"},children:[(0,r.jsxs)("label",{className:"switch",style:{marginRight:"5px"},children:[(0,r.jsx)("input",{type:"checkbox",checked:o.useCustomModel,onChange:()=>{l({type:n.TOGGLE_CUSTOM_MODEL})}}),(0,r.jsx)("span",{className:"slider"})]}),(0,r.jsx)("label",{className:"toggle-label",children:"使用自定义模型"})]})]}),(0,r.jsx)("div",{className:"model-input-container",children:o.useCustomModel?(0,r.jsxs)("div",{id:"custom-model-container",className:"input-with-button",children:[(0,r.jsx)("input",{ref:h,type:"text",id:"sdModel",placeholder:"输入模型ID或网址链接",value:o.customModelId,onChange:e=>{const t=e.target.value;l({type:n.SET_MODEL_PARAM,payload:{param:"customModelId",value:t}})},onBlur:()=>{if(!o.customModelId.trim())return;const e=(0,p.rL)(o.customModelId);e.isValid?e.value!==o.customModelId&&l({type:n.SET_MODEL_PARAM,payload:{param:"customModelId",value:e.value}}):h.current&&(0,p.UM)(h.current,"请输入有效的模型ID或tensor.art链接")},style:{width:"calc(100% - 40px)"}}),(0,r.jsx)("button",{className:"add-to-notepad",type:"button",title:"添加到记事本",onClick:()=>{let e="";if(e=o.useCustomModel?o.customModelId.trim():o.selectedModel?o.selectedModel.trim():"",!e)return void(0,p.P0)("没有可保存的模型ID",3e3,!0);const t=d.entries||[];let s=!1;for(let a=0;a<t.length;a++)if(!t[a].value||""===t[a].value.trim()){d.updateEntry(t[a].id,{value:e,category:"模型ID"}),s=!0;break}s||d.addEntry({category:"模型ID",value:e,trigger:""}),(0,p.P0)("已保存模型ID到记事本",2e3)},children:"+N"})]}):(0,r.jsx)("div",{id:"model-select-container",children:(0,r.jsx)("select",{id:"Modelname",value:o.selectedModel,onChange:e=>{l({type:n.SET_MODEL_PARAM,payload:{param:"selectedModel",value:e.target.value}})},style:{width:"100%"},children:[{value:"",label:"请选择模型"},{value:"802157190875069619",label:"FLUX-kg_09"},{value:"773719306170204263",label:"FLUX-XIZ"},{value:"755422449136357169",label:"SD3-Mccc"},{value:"748070388543653861",label:"可图"},{value:"797033333545650793",label:"SD3.5L-Rolo_hu"},{value:"784137028519452011",label:"Pony-WAI0731"},{value:"785591093992441279",label:"Pony 3D"},{value:"787353065419253689",label:"SDXL"}].map((e=>(0,r.jsx)("option",{value:e.value,children:e.label},e.value)))})})})]})};const x=function(e){let{index:t,lora:s={},onUpdate:i,onRemove:l,onAddToNotepad:n}=e;const o=s?.model||"",c=s?.weight??1,[d,h]=(0,a.useState)(o),[u,m]=(0,a.useState)(c.toString()),x=(0,a.useRef)(null),j=(0,a.useRef)(null),[g,v]=(0,a.useState)(!0),N=(0,a.useRef)(!1);function f(e){if(!e)return null;try{if(e.includes("tensor.art/models/")){const t=e.match(/tensor\.art\/models\/(\d+)/i);if(t&&t[1])return t[1]}if(/^\d+$/.test(e.trim()))return e.trim()}catch(e){console.error("提取ID出错:",e)}return null}return(0,a.useEffect)((()=>{if(!N.current){if(N.current=!0,x.current&&(x.current.value=o),j.current&&(j.current.value=c.toString()),o){const e=f(o);e&&e!==o?(h(e),i(t,"model",e)):h(o)}m(c.toString())}}),[]),(0,r.jsxs)("div",{className:"lora-entry","data-index":t,children:[(0,r.jsxs)("div",{className:"lora-entry-header",children:[(0,r.jsxs)("div",{className:"lora-number",children:["Lora ",t+1,":"]}),(0,r.jsx)("button",{className:"delete-lora",type:"button",onClick:()=>l(t),children:"×"})]}),(0,r.jsxs)("div",{className:"lora-entry-content",style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"10px"},children:[(0,r.jsxs)("div",{className:"lora-input-container",style:{flex:"3",display:"flex"},children:[(0,r.jsx)("input",{ref:x,type:"text",className:"lora-model-input",placeholder:"输入Lora模型名称",value:d,onChange:e=>{const s=e.target.value;h(s),s.trim()?i(t,"model",s):i(t,"model","")},onBlur:()=>{if(!d.trim())return h(""),void i(t,"model","");const e=f(d);e?(h(e),i(t,"model",e)):x.current&&(0,p.UM)(x.current,"请输入有效的数字ID或tensor.art链接")},onPaste:e=>{try{const s=f(e.clipboardData.getData("text"));s&&(e.preventDefault(),h(s),i(t,"model",s))}catch(e){console.error(`Lora ${t} 处理粘贴出错:`,e)}},style:{flex:"1",minWidth:"180px"}}),(0,r.jsx)("button",{className:"add-to-notepad",type:"button",title:"添加到记事本",onClick:()=>n(d),children:"+N"})]}),(0,r.jsxs)("div",{className:"lora-weight-container",style:{flex:"1",display:"flex",alignItems:"center"},children:[(0,r.jsx)("label",{className:"lora-weight-label",style:{marginRight:"5px"},children:"权重:"}),(0,r.jsx)("input",{ref:j,type:"text",className:"lora-weight-input",value:u,onChange:e=>{const t=e.target.value;if(m(t),""===t)return;const s=t.replace(/[^\d.-]/g,"");s!==t&&m(s)},onBlur:()=>{try{if(!u.trim()){return m("1.0"),void i(t,"weight",1)}const e=parseFloat(u);if(isNaN(e))return m("1.0"),i(t,"weight",1),void(j.current&&(0,p.UM)(j.current,"请输入有效的数字"));if(e<0||e>2){j.current&&(0,p.UM)(j.current,"权重必须在0到2之间");const s=Math.max(0,Math.min(2,e)).toFixed(1);m(s),i(t,"weight",parseFloat(s))}else{const s=e.toFixed(1);m(s),i(t,"weight",parseFloat(s))}}catch(e){console.error("验证权重出错:",e),m("1.0"),i(t,"weight",1)}},placeholder:"0-2",style:{width:"60px",flex:"none"}})]})]})]})};const j=function(){const{state:e,loras:t,updateLoras:s,addToPrompt:l}=(0,i.oi)(),n=(0,u.B)(),o=Array.isArray(t)?t:e&&Array.isArray(e.loras)?e.loras:[],[c,d]=(0,a.useState)(Date.now());(0,a.useEffect)((()=>{setTimeout((()=>d(Date.now())),0),(!t||0===t.length)&&e?.loras?.length>0&&s([...e.loras])}),[]);const h=e=>{const t=o.filter(((t,s)=>s!==e));s(t),setTimeout((()=>d(Date.now())),10)},m=(e,t,a)=>{const i=[...o];i[e]={...i[e],[t]:a},s(i)},j=e=>{if(e&&"string"==typeof e&&e.trim())try{const t=e.trim(),s=n.entries||[];let a=!1;for(let e=0;e<s.length;e++)if(!s[e].value||""===s[e].value.trim()){n.updateEntry(s[e].id,{value:t,category:"Lora"}),a=!0;break}a||n.addEntry({category:"Lora",value:t,trigger:""}),(0,p.P0)(`已添加 ${t} 到记事本`,2e3,!1)}catch(e){console.error("添加Lora到记事本时出错:",e),(0,p.P0)("添加Lora到记事本时出错",3e3,!0)}else(0,p.P0)("无法添加空的Lora模型到记事本",3e3,!0)},g=o.length>0?o:[{model:"",weight:1}];return(0,r.jsxs)("div",{className:"lora-manager",children:[(0,r.jsx)("div",{className:"lora-entries",children:g.map(((e,t)=>(0,r.jsx)(x,{index:t,lora:e,onUpdate:m,onRemove:h,onAddToNotepad:j},`lora-${t}-${c}`)))}),(0,r.jsx)("button",{className:"add-lora",type:"button",onClick:()=>{const e=[...o,{model:"",weight:1}];s(e),setTimeout((()=>d(Date.now())),10)},children:"+ 添加Lora"})]},`lora-manager-${c}`)};const g=function(e){let{onError:t}=e;const{state:s,dispatch:a,actionTypes:l,toggleAutoFillPrompt:n}=(0,i.oi)();return(0,r.jsxs)("div",{className:"prompt-inputs-container",children:[(0,r.jsxs)("div",{className:"prompt-group",children:[(0,r.jsxs)("div",{className:"prompt-header",children:[(0,r.jsx)("label",{htmlFor:"positive-prompt",children:"正向提示词:"}),(0,r.jsxs)("div",{className:"auto-fill-toggle",children:[(0,r.jsx)("input",{type:"checkbox",id:"auto-fill-prompt",checked:s.autoFillPrompt,onChange:e=>{n(e.target.checked)}}),(0,r.jsx)("label",{htmlFor:"auto-fill-prompt",children:"自动填充提示词"})]})]}),(0,r.jsx)("textarea",{id:"positive-prompt",className:"prompt-textarea",placeholder:"输入正向提示词",value:s.prompt,onChange:e=>{a({type:l.SET_PROMPT,value:e.target.value})},"data-original-prompt":s.originalPrompt||"",onFocus:e=>{!e.target.value&&e.target.dataset.originalPrompt&&s.autoFillPrompt&&a({type:l.SET_PROMPT,value:e.target.dataset.originalPrompt})}})]}),(0,r.jsxs)("div",{className:"prompt-group",children:[(0,r.jsx)("label",{htmlFor:"negative-prompt",children:"负向提示词:"}),(0,r.jsx)("textarea",{id:"negative-prompt",className:"prompt-textarea",placeholder:"输入负向提示词",value:s.negativePrompt,onChange:e=>{a({type:l.SET_NEGATIVE_PROMPT,value:e.target.value})}})]}),(0,r.jsxs)("div",{className:"section info-section",children:[(0,r.jsxs)("ul",{className:"info-links",children:[(0,r.jsx)("li",{children:(0,r.jsx)("a",{href:"https://github.com/Writer-z/jjdd-huatu-st",target:"_blank",rel:"noopener noreferrer",children:"在GitHub获取最新版本"})}),(0,r.jsx)("li",{children:(0,r.jsx)("a",{href:"https://afdian.com/a/jjdd-huatu",target:"_blank",rel:"noopener noreferrer",children:"联系开发者"})})]}),(0,r.jsx)("div",{className:"api-notice",children:"欢迎使用简简单单画图扩展~有任何问题都可以联系作者！"})]})]})};var v=s(960);s(791);const N=function(){const{state:e,setModelParam:t}=(0,i.oi)(),{model:s}=e,[l,n]=(0,a.useState)(!0),[,o]=(0,a.useState)({});(0,a.useEffect)((()=>{const e=setTimeout((()=>o({})),100),t=setTimeout((()=>o({})),500);return()=>{clearTimeout(e),clearTimeout(t)}}),[]);const[c,d]=(0,a.useState)({width:s.width.toString(),height:s.height.toString(),count:s.count.toString(),steps:s.steps.toString(),cfgScale:s.cfgScale.toString(),seed:s.seed.toString(),clipSkip:s.clipSkip.toString()}),[h,u]=(0,a.useState)(!1),x=(0,a.useRef)(null),{handleGenerateButtonClick:N}=(0,v.A)();(0,a.useEffect)((()=>{d({width:s.width.toString(),height:s.height.toString(),count:s.count.toString(),steps:s.steps.toString(),cfgScale:s.cfgScale.toString(),seed:s.seed.toString(),clipSkip:s.clipSkip.toString()})}),[s]);const f=(e,a,i)=>{if(d((t=>({...t,[e]:a}))),""===a)return;const l="width"===e?2300:3200,n=(0,p.n8)(a,"numeric",{min:256,max:l,defaultValue:512});if(!n.isValid)return void(i?(0,p.UM)(i,n.error):(0,p.P0)(n.error,3e3,!0));x.current=e;let r="width"===e?n.value:s.width,o="height"===e?n.value:s.height;if(h){const t=s.width/s.height;"width"===e?(o=Math.round(r/t),o=Math.max(256,Math.min(3200,o)),d((e=>({...e,height:o.toString()})))):(r=Math.round(o*t),r=Math.max(256,Math.min(2300,r)),d((e=>({...e,width:r.toString()}))))}else r=Math.max(256,Math.min(2300,r)),o=Math.max(256,Math.min(3200,o)),"width"===e&&r!==n.value?d((e=>({...e,width:r.toString()}))):"height"===e&&o!==n.value&&d((e=>({...e,height:o.toString()})));"width"===e?(t("width",r),h&&t("height",o)):(t("height",o),h&&t("width",r))},b=(e,s,a)=>{let i=1,l=9999;switch(e){case"count":i=1,l=4;break;case"steps":i=10,l=60;break;case"cfgScale":i=1,l=30;break;case"seed":i=-1,l=Number.MAX_SAFE_INTEGER;break;case"clipSkip":i=1,l=12}if(d((t=>({...t,[e]:s}))),""===s)return;const n=(0,p.n8)(s,"numeric",{min:i,max:l,defaultValue:i});n.isValid?t(e,n.value):a?(0,p.UM)(a,n.error):(0,p.P0)(n.error,3e3,!0)},y=(e,s)=>{t(e,s)};return(0,r.jsxs)("div",{className:"panel-container",children:[(0,r.jsx)("div",{className:"input-group",children:(0,r.jsx)(m,{})}),(0,r.jsxs)("div",{className:"params-group",children:[(0,r.jsxs)("div",{className:"grid-3",children:[(0,r.jsxs)("div",{className:"input-group",children:[(0,r.jsxs)("label",{htmlFor:"width",children:["宽度:",(0,r.jsx)("button",{className:"dimension-lock-btn",title:h?"解除宽高比锁定":"锁定宽高比",onClick:()=>{u(!h)},children:(0,r.jsx)("i",{className:"fa "+(h?"fa-lock":"fa-unlock")})})]}),(0,r.jsx)("input",{type:"text",id:"width",value:c.width,onChange:e=>f("width",e.target.value,e.target),onBlur:()=>{""===c.width&&d((e=>({...e,width:s.width.toString()})))},placeholder:"256-2300"})]}),(0,r.jsxs)("div",{className:"input-group",children:[(0,r.jsx)("label",{htmlFor:"height",children:"高度:"}),(0,r.jsx)("input",{type:"text",id:"height",value:c.height,onChange:e=>f("height",e.target.value,e.target),onBlur:()=>{""===c.height&&d((e=>({...e,height:s.height.toString()})))},placeholder:"256-3200"})]}),(0,r.jsxs)("div",{className:"input-group",children:[(0,r.jsx)("label",{htmlFor:"count",children:"生成数量:"}),(0,r.jsx)("input",{type:"text",id:"count",value:c.count,onChange:e=>b("count",e.target.value,e.target),onBlur:()=>{""===c.count&&d((e=>({...e,count:s.count.toString()})))},placeholder:"1-4"})]})]}),(0,r.jsxs)("div",{className:"grid-3",children:[(0,r.jsxs)("div",{className:"input-group",children:[(0,r.jsx)("label",{htmlFor:"steps",children:"步数:"}),(0,r.jsx)("input",{type:"text",id:"steps",value:c.steps,onChange:e=>b("steps",e.target.value,e.target),onBlur:()=>{""===c.steps&&d((e=>({...e,steps:s.steps.toString()})))},placeholder:"10-60"})]}),(0,r.jsxs)("div",{className:"input-group",children:[(0,r.jsx)("label",{htmlFor:"cfgScale",children:"CFG Scale:"}),(0,r.jsx)("input",{type:"text",id:"cfgScale",value:c.cfgScale,onChange:e=>b("cfgScale",e.target.value,e.target),onBlur:()=>{""===c.cfgScale&&d((e=>({...e,cfgScale:s.cfgScale.toString()})))},placeholder:"1-30"})]}),(0,r.jsxs)("div",{className:"input-group",children:[(0,r.jsx)("label",{htmlFor:"seed",children:"种子:"}),(0,r.jsx)("input",{type:"text",id:"seed",value:c.seed,onChange:e=>b("seed",e.target.value,e.target),onBlur:()=>{""===c.seed&&d((e=>({...e,seed:s.seed.toString()})))},placeholder:"-1为随机"})]})]}),(0,r.jsxs)("div",{className:"grid-3",children:[(0,r.jsxs)("div",{className:"input-group",children:[(0,r.jsx)("label",{htmlFor:"vae",children:"VAE:"}),(0,r.jsxs)("select",{id:"vae",value:s.vae,onChange:e=>y("vae",e.target.value),children:[(0,r.jsx)("option",{value:"ae.sft",children:"ae.sft"}),(0,r.jsx)("option",{value:"Automatic",children:"Automatic"}),(0,r.jsx)("option",{value:"None",children:"None"}),(0,r.jsx)("option",{value:"vae-ft-mse-840000-ema-pruned.ckpt",children:"vae-ft-mse-840000-ema-pruned"}),(0,r.jsx)("option",{value:"kl-f8-anime.ckpt",children:"kl-f8-anime"}),(0,r.jsx)("option",{value:"kl-f8-anime2.ckpt",children:"kl-f8-anime2"}),(0,r.jsx)("option",{value:"ClearVAE.safetensors",children:"ClearVAE"}),(0,r.jsx)("option",{value:"cute_vae.safetensors",children:"cute_vae"}),(0,r.jsx)("option",{value:"sdxl_vae.safetensors",children:"sdxl_vae"}),(0,r.jsx)("option",{value:"sdxl-vae-fp16-fix.safetensors",children:"sdxl-vae-fp16-fix"}),(0,r.jsx)("option",{value:"animevae.pt",children:"animevae"})]})]}),(0,r.jsxs)("div",{className:"input-group",children:[(0,r.jsx)("label",{htmlFor:"sampler",children:"采样器:"}),(0,r.jsxs)("select",{id:"sampler",value:s.sampler,onChange:e=>y("sampler",e.target.value),children:[(0,r.jsx)("option",{value:"Euler",children:"Euler"}),(0,r.jsx)("option",{value:"Euler a",children:"Euler a"}),(0,r.jsx)("option",{value:"DDIM",children:"DDIM"}),(0,r.jsx)("option",{value:"DPM++ 2M",children:"DPM++ 2M"}),(0,r.jsx)("option",{value:"DPM++ SDE",children:"DPM++ SDE"}),(0,r.jsx)("option",{value:"DPM++ 2M SDE",children:"DPM++ 2M SDE"}),(0,r.jsx)("option",{value:"DPM fast",children:"DPM fast"}),(0,r.jsx)("option",{value:"DPM2 Karras",children:"DPM2 Karras"}),(0,r.jsx)("option",{value:"DPM++ 2M Karras",children:"DPM++ 2M Karras"}),(0,r.jsx)("option",{value:"DPM++ SDE Karras",children:"DPM++ SDE Karras"}),(0,r.jsx)("option",{value:"DPM++ 2M SDE Karras",children:"DPM++ 2M SDE Karras"})]})]}),(0,r.jsxs)("div",{className:"input-group",children:[(0,r.jsx)("label",{htmlFor:"clipSkip",children:"Clip Skip:"}),(0,r.jsx)("input",{type:"text",id:"clipSkip",value:c.clipSkip,onChange:e=>b("clipSkip",e.target.value,e.target),onBlur:()=>{""===c.clipSkip&&d((e=>({...e,clipSkip:s.clipSkip.toString()})))},placeholder:"1-12"})]})]})]}),(0,r.jsxs)("div",{className:"accordion",children:[(0,r.jsxs)("div",{className:"accordion-header",onClick:()=>{n(!l)},children:[(0,r.jsx)("div",{className:"accordion-title",children:"Lora 设置"}),(0,r.jsx)("div",{className:"accordion-icon "+(l?"open":""),children:"▼"})]}),(0,r.jsx)("div",{className:"accordion-content "+(l?"open":""),style:{display:"block",height:l?"auto":"0",overflow:"hidden",transition:"height 0.3s ease",padding:l?"10px 0":"0",opacity:l?"1":"0"},children:(0,r.jsx)(j,{})})]}),(0,r.jsx)(g,{}),(0,r.jsx)("div",{id:"jjdd-huatu-toast",className:"jjdd-huatu-toast"})]})};const f=function(){const{state:e,setImageDisplayMode:t,setButtonSize:s,setImageMaxHeight:l}=(0,i.oi)(),{imageDisplayMode:n,buttonWidth:o,buttonHeight:c,imageMaxHeight:d}=e,[h,u]=(0,a.useState)(o?.toString()||""),[p,m]=(0,a.useState)(c?.toString()||"");(0,a.useEffect)((()=>{u(o?.toString()||""),m(c?.toString()||"")}),[o,c]);const x=e=>{const t=e.target.value;if(u(t),"blur"===e.type){const e=""===t?"":Number(t);s(e,c)}},j=e=>{const t=e.target.value;if(m(t),"blur"===e.type){const e=""===t?"":Number(t);s(o,e)}},g=(e,t)=>{if("Enter"===e.key){if(e.preventDefault(),"width"===t){const e=""===h?"":Number(h);s(e,c)}else if("height"===t){const e=""===p?"":Number(p);s(o,e)}e.target.blur()}};return(0,a.useEffect)((()=>{"function"!=typeof window.isMobile&&(window.isMobile=function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)})}),[]),(0,r.jsxs)("div",{className:"params-container",children:[(0,r.jsxs)("div",{className:"input-group",children:[(0,r.jsx)("label",{htmlFor:"imageDisplayMode",children:"图片显示模式"}),(0,r.jsxs)("select",{id:"imageDisplayMode",value:n,onChange:e=>{t(e.target.value)},children:[(0,r.jsx)("option",{value:"add",children:"添加新消息"}),(0,r.jsx)("option",{value:"replace",children:"替换当前消息"}),(0,r.jsx)("option",{value:"button",children:"更新按钮背景"})]})]}),(0,r.jsxs)("div",{className:"image-settings",children:[(0,r.jsx)("h4",{children:"图片最大高度"}),(0,r.jsx)("div",{className:"settings-group",children:(0,r.jsxs)("select",{id:"imageMaxHeight",value:d,onChange:e=>{l(e.target.value)},children:[(0,r.jsx)("option",{value:"40vh",children:"40%"}),(0,r.jsx)("option",{value:"60vh",children:"60%"}),(0,r.jsx)("option",{value:"80vh",children:"80%"}),(0,r.jsx)("option",{value:"100vh",children:"100%"})]})})]}),(0,r.jsxs)("div",{className:"button-size-settings",children:[(0,r.jsx)("h4",{children:"按钮尺寸设置"}),(0,r.jsxs)("div",{className:"settings-row",children:[(0,r.jsxs)("div",{className:"settings-group",children:[(0,r.jsx)("label",{htmlFor:"buttonWidth",children:"宽度:"}),(0,r.jsx)("input",{type:"number",id:"buttonWidth",value:h,onChange:x,onBlur:x,onKeyDown:e=>g(e,"width")})]}),(0,r.jsxs)("div",{className:"settings-group",children:[(0,r.jsx)("label",{htmlFor:"buttonHeight",children:"高度:"}),(0,r.jsx)("input",{type:"number",id:"buttonHeight",value:p,onChange:j,onBlur:j,onKeyDown:e=>g(e,"height")})]})]})]}),(0,r.jsxs)("div",{className:"display-info-container",children:[(0,r.jsx)("h4",{children:"图片显示说明"}),(0,r.jsxs)("div",{className:"info-content",children:[(0,r.jsx)("p",{children:"目前支持三种在酒馆消息中显示图片方式，后续根据反馈会持续优化"}),(0,r.jsxs)("ul",{children:[(0,r.jsxs)("li",{children:[(0,r.jsx)("strong",{children:"添加新消息"}),": 生成一条带画图结果的新消息，最普通的方式"]}),(0,r.jsxs)("li",{children:[(0,r.jsx)("strong",{children:"替换当前消息"}),": 在画图按钮所在消息楼层末尾显示图片，适合省token"]}),(0,r.jsxs)("li",{children:[(0,r.jsx)("strong",{children:"更新按钮背景"}),": 在按钮显示图片，方法灵活优化后适合前端卡"]})]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"图片最大高度"}),": 调整新增、替换消息图片模式的图片大小"]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"按钮尺寸"}),": 调整更新按钮背景模式的图片大小"]})]})]})]})};var b=s(910);const y=function(){const{state:e,dispatch:t,actionTypes:s,setActiveTab:l,setPrompt:n,setModelParam:o,toggleCustomModel:c}=(0,i.oi)(),d=(0,u.B)(),[h,p]=(0,a.useState)(null),m=(e,t,s)=>{d.updateEntry(e,{[t]:s})},x=function(e){return"numeric"===(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"text")?(0,b.DS)(e,0,Number.MAX_SAFE_INTEGER):{isValid:!0,message:"",value:e}},j=(e,t,s)=>{e.preventDefault();const a=e.clipboardData.getData("text");if(a)if("value"===s){const e=x(a,"numeric");e.isValid&&m(t,s,e.value)}else m(t,s,a)};return(0,r.jsxs)("div",{className:"notepad-container",children:[h&&(0,r.jsxs)("div",{className:"notepad-error",children:[h,(0,r.jsx)("button",{className:"error-close",onClick:()=>p(null),children:"×"})]}),(0,r.jsx)("div",{className:"notepad-header-controls",children:(0,r.jsxs)("button",{className:"notepad-add-button",onClick:()=>{try{d.addEntry({category:"类别/说明",value:"",trigger:""})}catch(e){p(`添加失败: ${e.message}`),setTimeout((()=>p(null)),3e3)}},children:[(0,r.jsx)("i",{className:"fas fa-plus"})," 添加项目"]})}),(0,r.jsx)("div",{id:"notepad-entries-container",children:0===d.entries.length?(0,r.jsx)("div",{className:"empty-message",children:'暂无记录，点击上方"添加项目"按钮创建'}):d.entries.map(((a,i)=>(0,r.jsxs)("div",{className:"notepad-entry",children:[(0,r.jsxs)("div",{className:"entry-header",children:[(0,r.jsx)("div",{className:"entry-number",children:i+1}),(0,r.jsxs)("div",{className:"entry-actions",children:[(0,r.jsx)("button",{className:"add-to-model",onClick:()=>{var e;(e=a.value)&&"string"==typeof e&&e.trim()?(o("customModelId",e.trim()),c(),l("generate")):(p("无法添加到模型：内容为空"),setTimeout((()=>p(null)),3e3))},title:"添加到模型",children:"+M"}),(0,r.jsx)("button",{className:"add-to-lora",onClick:()=>(a=>{if(a&&"string"==typeof a&&a.trim()){const i=[...e.loras];let n=!1;for(let e=0;e<i.length;e++)if(!i[e].model||!i[e].model.trim()){i[e]={...i[e],model:a.trim()},n=!0;break}n||i.push({model:a.trim(),weight:.8}),t({type:s.UPDATE_LORAS,payload:i}),l("generate")}else p("无法添加到Lora：内容为空"),setTimeout((()=>p(null)),3e3)})(a.value),title:"添加到Lora",children:"+L"})]}),(0,r.jsx)("input",{type:"text",className:"notepad-category-input",placeholder:"类别/说明",value:a.category||"",onChange:e=>m(a.id,"category",e.target.value)}),(0,r.jsx)("button",{className:"add-to-prompt",onClick:()=>(t=>{if(t&&"string"==typeof t&&t.trim()){const s=e.prompt?e.prompt.trim():"",a=s?`${s}, ${t.trim()}`:t.trim();n(a),l("generate")}else p("无法添加到提示词：内容为空"),setTimeout((()=>p(null)),3e3)})(a.trigger),title:"添加到提示词",children:"+P"}),(0,r.jsx)("button",{className:"delete-notepad",onClick:()=>{return e=a.id,void d.removeEntry(e);var e},title:"删除",children:"×"})]}),(0,r.jsxs)("div",{className:"entry-content",children:[(0,r.jsx)("input",{type:"text",className:"notepad-numeric-input",placeholder:"输入数字内容",value:a.value||"",onChange:e=>{const t=x(e.target.value,"numeric");t.isValid&&m(a.id,"value",t.value)},onPaste:e=>j(e,a.id,"value")}),(0,r.jsx)("input",{type:"text",className:"notepad-trigger-input",placeholder:"触发词",value:a.trigger||"",onChange:e=>m(a.id,"trigger",e.target.value),onPaste:e=>j(e,a.id,"trigger")})]})]},a.id||i)))})]})};const S=function(){const{state:e,toggleUpscaler:t,setUpscalerParam:s}=(0,i.oi)(),{upscaler:l}=e,[n,o]=(0,a.useState)({resizeX:l.resizeX,resizeY:l.resizeY,steps:l.steps,denoisingStrength:l.denoisingStrength}),[c,d]=(0,a.useState)({resizeX:null,resizeY:null,steps:null,denoisingStrength:null}),[h,u]=(0,a.useState)(!1),p=(0,a.useRef)(null);(0,a.useEffect)((()=>{o({resizeX:l.resizeX,resizeY:l.resizeY,steps:l.steps,denoisingStrength:l.denoisingStrength})}),[l]);const m=(e,t)=>{o((s=>({...s,[e]:t}))),d((t=>({...t,[e]:null})))},x=(e,t)=>{((e,t)=>{if(""===t)return;const a=Number(t);let i;switch(e){case"resizeX":i=(0,b.DS)(a,512,2300,"目标宽度");break;case"resizeY":i=(0,b.DS)(a,512,3200,"目标高度");break;case"steps":i=(0,b.DS)(a,10,60,"步数");break;case"denoisingStrength":i=(0,b.DS)(a,0,1,"降噪强度");break;default:i={isValid:!0,error:null}}d((t=>({...t,[e]:i.error}))),i.isValid&&s(e,a)})(e,t),"resizeX"!==e&&"resizeY"!==e||""===t||!h||g(e,t)},j=(e,t)=>{if(m(e,t),""===t)return;p.current=e;const s="resizeX"===e?2300:3200,a=Number(t);if(!(isNaN(a)||a<512||a>s)&&h){const t=(l.resizeX||1024)/(l.resizeY||1024);if("resizeX"===e){const e=Math.round(a/t),s=Math.max(512,Math.min(3200,e));m("resizeY",s.toString())}else{const e=Math.round(a*t),s=Math.max(512,Math.min(2300,e));m("resizeX",s.toString())}}},g=(e,t)=>{if(!l.enabled)return;const a=Number(t);if(isNaN(a)||a<=0)return;const i=(l.resizeX||1024)/(l.resizeY||1024);if("resizeX"===e){const e=Math.round(a/i),t=Math.max(512,Math.min(3200,e));m("resizeY",t.toString()),s("resizeY",t)}else{const e=Math.round(a*i),t=Math.max(512,Math.min(2300,e));m("resizeX",t.toString()),s("resizeX",t)}};return(0,r.jsxs)("div",{className:"upscale-container",children:[(0,r.jsxs)("div",{className:"upscale-header",children:[(0,r.jsx)("h3",{children:"高清修复"}),(0,r.jsxs)("div",{className:"upscale-toggle",children:[(0,r.jsxs)("label",{className:"switch",children:[(0,r.jsx)("input",{type:"checkbox",checked:l.enabled,onChange:()=>{t()}}),(0,r.jsx)("span",{className:"slider"})]}),(0,r.jsx)("span",{children:"启用高清修复"})]})]}),(0,r.jsxs)("div",{className:"upscale-settings "+(l.enabled?"":"disabled"),children:[(0,r.jsxs)("div",{className:"input-group",children:[(0,r.jsx)("label",{htmlFor:"upscaler-model",children:"放大模型"}),(0,r.jsxs)("select",{id:"upscaler-model",value:l.model,onChange:e=>s("model",e.target.value),disabled:!l.enabled,children:[(0,r.jsx)("option",{value:"4x-UltraSharp",children:"4x-UltraSharp"}),(0,r.jsx)("option",{value:"4x-AnimeSharp",children:"4x-AnimeSharp"}),(0,r.jsx)("option",{value:"SwinIR_4x",children:"SwinIR_4x"}),(0,r.jsx)("option",{value:"ESRGAN_4x",children:"ESRGAN_4x"}),(0,r.jsx)("option",{value:"R-ESRGAN 4x+",children:"R-ESRGAN 4x+"}),(0,r.jsx)("option",{value:"R-ESRGAN 4x+ Anime6B",children:"R-ESRGAN 4x+ Anime6B"}),(0,r.jsx)("option",{value:"4x_foolhardy_Remacri",children:"4x_foolhardy_Remacri"}),(0,r.jsx)("option",{value:"4x_NMKD-Siax_200k",children:"4x_NMKD-Siax_200k"}),(0,r.jsx)("option",{value:"4x_NMKD-Superscale-SP_178000_G",children:"4x_NMKD-Superscale-SP"}),(0,r.jsx)("option",{value:"8x_NMKD-Superscale_150000_G",children:"8x_NMKD-Superscale"}),(0,r.jsx)("option",{value:"Latent",children:"Latent"})]})]}),(0,r.jsxs)("div",{className:"params-grid",children:[(0,r.jsxs)("div",{className:"input-group",children:[(0,r.jsxs)("label",{htmlFor:"resize-x",children:["目标宽度:",(0,r.jsx)("button",{className:"dimension-lock-btn",title:h?"解除宽高比锁定":"锁定宽高比",onClick:()=>{u(!h)},disabled:!l.enabled,children:(0,r.jsx)("i",{className:"fa "+(h?"fa-lock":"fa-unlock")})})]}),(0,r.jsx)("input",{type:"text",id:"resize-x",value:n.resizeX,onChange:e=>j("resizeX",e.target.value),onBlur:e=>x("resizeX",e.target.value),disabled:!l.enabled,placeholder:"512-2300"}),c.resizeX&&(0,r.jsx)("div",{className:"input-error",children:c.resizeX})]}),(0,r.jsxs)("div",{className:"input-group",children:[(0,r.jsx)("label",{htmlFor:"resize-y",children:"目标高度"}),(0,r.jsx)("input",{type:"text",id:"resize-y",value:n.resizeY,onChange:e=>j("resizeY",e.target.value),onBlur:e=>x("resizeY",e.target.value),disabled:!l.enabled,placeholder:"512-3200"}),c.resizeY&&(0,r.jsx)("div",{className:"input-error",children:c.resizeY})]}),(0,r.jsxs)("div",{className:"input-group",children:[(0,r.jsx)("label",{htmlFor:"upscale-steps",children:"步数"}),(0,r.jsx)("input",{type:"text",id:"upscale-steps",value:n.steps,onChange:e=>m("steps",e.target.value),onBlur:e=>x("steps",e.target.value),disabled:!l.enabled,placeholder:"10-60"}),c.steps&&(0,r.jsx)("div",{className:"input-error",children:c.steps})]}),(0,r.jsxs)("div",{className:"input-group",children:[(0,r.jsx)("label",{htmlFor:"denoising-strength",children:"降噪强度"}),(0,r.jsx)("input",{type:"text",id:"denoising-strength",value:n.denoisingStrength,onChange:e=>m("denoisingStrength",e.target.value),onBlur:e=>x("denoisingStrength",e.target.value),disabled:!l.enabled,placeholder:"0.0-1.0"}),c.denoisingStrength&&(0,r.jsx)("div",{className:"input-error",children:c.denoisingStrength})]})]}),(0,r.jsx)("div",{className:"upscale-description",children:(0,r.jsx)("p",{children:"高清修复将在图像生成后自动应用，可能会增加排队等待和处理时间"})}),(0,r.jsxs)("div",{className:"upscale-tips",children:[(0,r.jsx)("h4",{children:"使用提示"}),(0,r.jsxs)("ul",{children:[(0,r.jsx)("li",{children:"点击宽度旁的锁头图标可锁定/解锁宽高比"}),(0,r.jsx)("li",{children:"降噪强度越大，修复的创造性越强，但可能偏离原图"}),(0,r.jsx)("li",{children:"步数越多，效果越好，但处理时间也越长"})]})]})]})]})};const k=function(){return(0,r.jsxs)("div",{className:"workflow-container",children:[(0,r.jsx)("div",{className:"workflow-header",children:(0,r.jsx)("h3",{children:"工作流画图待开发中..."})}),(0,r.jsxs)("div",{className:"workflow-image-container",children:[(0,r.jsx)("img",{src:"https://www.now61.com/f/Dzbpiq/IMG_20250412_163939.jpg",alt:"简简单单",className:"workflow-preview-image"}),(0,r.jsx)("div",{className:"image-caption",children:"暂时偷懒放一张图在这..."})]})]})};var M=s(172);const E=function(e){let{isOpen:t,onClose:s}=e;const{state:n,setApiKey:o,refreshStamina:c}=(0,i.oi)(),{getDrawingParams:d}=(0,M.A)(),[h,u]=(0,a.useState)(""),[m,x]=(0,a.useState)(!1),[j,g]=(0,a.useState)("");(0,a.useEffect)((()=>{t&&(u(n.apiKey||""),g(""))}),[t,n.apiKey]);const v=()=>{s()},N=e=>{const t=(0,b.ek)(e);return t.isValid?(g(""),!0):(g(t.error),!1)};return t?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"modal-overlay",onClick:v}),(0,r.jsx)("div",{className:"modal api-key-modal",children:(0,r.jsxs)("div",{className:"modal-content",children:[(0,r.jsxs)("div",{className:"modal-header",children:[(0,r.jsx)("h4",{children:"JJDD API Key"}),(0,r.jsx)("button",{className:"close-modal-btn",onClick:v,"aria-label":"关闭",children:"×"})]}),(0,r.jsxs)("div",{className:"modal-body",children:[(0,r.jsx)("input",{type:"text",className:"api-key-input "+(j?"input-error":""),placeholder:"请输入您的API密钥",value:h,onChange:e=>{u(e.target.value),j&&g("")},disabled:m}),j&&(0,r.jsx)("div",{className:"error-message",children:j})]}),(0,r.jsxs)("div",{className:"modal-footer",children:[(0,r.jsx)("button",{className:"modal-btn save-btn",onClick:()=>{const e=h.trim();N(e)?(o(e),(0,p.P0)("API密钥已保存",3e3,!1),s()):(0,p.UM)(document.querySelector(".api-key-input"),j)},disabled:m,children:"保存"}),(0,r.jsx)("button",{className:"modal-btn test-btn",onClick:async()=>{const e=h.trim();if(N(e)){x(!0);try{const t=d();if(!t.params)throw new Error(t.error||"获取参数失败");const s={...t.params,prompt:t.params.prompt||"测试API请求示例，测试生成",negativePrompt:t.params.negativePrompt||"低质量，模糊",count:1,jjddApiKey:e||t.params.jjddApiKey};console.log("使用统一格式参数进行API测试",s);const a=await(0,l._b)(e,s);if(a.valid){(0,p.P0)("API密钥有效! "+(a.consumeStamina?`预估消耗体力: ${a.consumeStamina}`:""),4e3,!1);try{await c(e)}catch(e){console.error("刷新体力信息失败:",e)}}else"INVALID_FORMAT"===a.error?(g("API密钥格式不正确！"),(0,p.UM)(document.querySelector(".api-key-input"),"格式不正确！")):(0,p.P0)(`API密钥无效: ${a.error}`,3e3,!0)}catch(e){console.error("API密钥测试失败:",e),(0,p.P0)(`API密钥测试失败: ${e.message}`,3e3,!0)}finally{x(!1)}}else(0,p.UM)(document.querySelector(".api-key-input"),j)},disabled:m,children:m?"测试中...":"测试API"}),(0,r.jsx)("button",{className:"modal-btn remove-btn",onClick:()=>{u(""),g(""),o(""),(0,p.P0)("API密钥已移除",3e3,!1),s()},disabled:m,children:"移除密钥"})]})]})})]}):null};var P=s(440);const w=function(){const[e,t]=(0,a.useState)(!1),{state:s}=(0,i.oi)(),{apiKey:l,stamina:n}=s,{showApiToast:o}=(0,P.be)();return n&&Math.round(n.used/n.total*100),n&&(n.total,n.used),(0,r.jsxs)("div",{className:"tips-container",children:[(0,r.jsx)("div",{className:"api-key-section",children:(0,r.jsxs)("div",{className:"api-key-card",children:[(0,r.jsxs)("div",{className:"api-key-header",children:[(0,r.jsx)("h4",{children:"API 密钥"}),(0,r.jsx)("button",{className:"api-key-settings-btn",onClick:()=>{t(!0)},children:"点击设置"})]}),(0,r.jsxs)("div",{className:"api-key-description",children:[(0,r.jsx)("p",{children:"设置您的API密钥以使用扩展功能。"}),l?(0,r.jsx)("div",{className:"api-key-status success",children:(0,r.jsx)("div",{className:"status-line",children:"API密钥已配置成功！"})}):(0,r.jsx)("div",{className:"api-key-status warning",children:"未配置API密钥，请先设置API密钥。"})]})]})}),(0,r.jsx)(E,{isOpen:e,onClose:()=>{t(!1)}}),(0,r.jsx)("h3",{children:"使用技巧"}),(0,r.jsxs)("div",{className:"tips-content",children:[(0,r.jsxs)("div",{className:"tips-section",children:[(0,r.jsx)("h4",{children:"基础生图"}),(0,r.jsxs)("ul",{className:"tips-list",children:[(0,r.jsx)("li",{children:"确保有魔法，启动后端程序并成功运行"}),(0,r.jsx)("li",{children:"点击设置，输入正确API密钥，进行测试并保存"}),(0,r.jsx)("li",{children:"打开画图设置面板输入提示词和选好画图参数"}),(0,r.jsx)("li",{children:"选择添加新消息模式，点击生成图片按钮，等待生成结果"})]})]}),(0,r.jsxs)("div",{className:"tips-section",children:[(0,r.jsx)("h4",{children:"进阶技巧"}),(0,r.jsxs)("ul",{className:"tips-list",children:[(0,r.jsx)("li",{children:"酒馆世界书添加画图指南，设置好正则，聊天消息中生成画图按钮"}),(0,r.jsx)("li",{children:"可以选择替换当前消息显示图片模式或更新按钮背景模式"}),(0,r.jsxs)("li",{children:["可以选择预设的模型或者从 ",(0,r.jsx)("a",{href:"https://tensor.art/models",children:"🌏其它网站"}),"中导入模型和lora"]}),(0,r.jsx)("li",{children:"正提示词输入框放常用的质量提示词，AI回复消息提示词正则替换为按钮"}),(0,r.jsx)("li",{children:"点击正则替换的按钮生成图片，显示在消息末尾或更新按钮背景"})]})]}),(0,r.jsxs)("div",{className:"tips-section",children:[(0,r.jsx)("h4",{children:"参数建议"}),(0,r.jsxs)("ul",{className:"tips-list",children:[(0,r.jsx)("li",{children:"画图前可点击测试API按钮或者图片上的🔑预估消耗体力值"}),(0,r.jsx)("li",{children:"步数: 通常20-30步能获得较好效果，步数越多越丰富消耗体力越多"}),(0,r.jsx)("li",{children:"CFG Scale默认7，种子: 使用固定种子可以获得可重复的结果"}),(0,r.jsx)("li",{children:"单次画图任务数量上限4张"})]})]}),(0,r.jsxs)("div",{className:"tips-section",children:[(0,r.jsx)("h4",{children:"高级用法"}),(0,r.jsxs)("ul",{className:"tips-list",children:[(0,r.jsx)("li",{children:"记事本功能可以保存常用的提示词和模型ID并且方便快速调用"}),(0,r.jsx)("li",{children:"画图面板中绿色三角形可切换体力值界面支持手动刷新"}),(0,r.jsx)("li",{children:"点击消息中生成的图片可以快速实现打开面板、ROLL图、预估体力、取消任务"}),(0,r.jsx)("li",{children:'使用/qx、/QX斜杠命令以及"✂"按钮可以取消未running的任务'})]})]}),(0,r.jsxs)("div",{className:"tips-section",children:[(0,r.jsx)("h4",{children:"常见问题"}),(0,r.jsxs)("ul",{className:"tips-list",children:[(0,r.jsx)("li",{children:"遇到报错可查看后端程序排查，一般500是网络问题，400是参数非法问题"}),(0,r.jsx)("li",{children:"画图任务时间包括排队等待时间和运行时间，受图片复杂程度、服务器拥挤程度影响，如若遇到长时间排队可取消任务"}),(0,r.jsx)("li",{children:"图片下载到本地文件夹，向浏览器提供3天缓存，如若遇到图片不显示请确保后端程序在运行"}),(0,r.jsx)("li",{children:"如果遇到其它问题可以在爱发电或者QQ上联系开发者"})]})]})]}),(0,r.jsx)("div",{className:"tips-footer",children:(0,r.jsxs)("div",{className:"section info-section",children:[(0,r.jsxs)("ul",{className:"info-links",children:[(0,r.jsx)("li",{children:(0,r.jsx)("a",{href:"https://github.com/Writer-z/jjdd-huatu-st",target:"_blank",rel:"noopener noreferrer",children:"在GitHub获取最新版本"})}),(0,r.jsx)("li",{children:(0,r.jsx)("a",{href:"https://afdian.com/a/jjdd-huatu",target:"_blank",rel:"noopener noreferrer",children:"联系开发者"})})]}),(0,r.jsx)("div",{className:"api-notice",children:"欢迎使用简简单单画图扩展~有任何问题都可以联系作者！"})]})})]})};const A=function(){const{state:e,setActiveTab:t}=(0,i.oi)(),{activeTab:s}=e,[l,n]=(0,a.useState)(null),o=[{id:"generate",label:"生成参数",content:(0,r.jsx)(N,{})},{id:"params",label:"出图设置",content:(0,r.jsx)(f,{})},{id:"notepad",label:"记事本",content:(0,r.jsx)(y,{})},{id:"upscale",label:"高清修复",content:(0,r.jsx)(S,{})},{id:"workflow",label:"工作流",content:(0,r.jsx)(k,{})},{id:"tips",label:"使用技巧",content:(0,r.jsx)(w,{})}];return(0,r.jsxs)("div",{className:"tab-system",children:[l&&(0,r.jsxs)("div",{className:"tab-error-container",children:[(0,r.jsx)("div",{className:"tab-error",children:l}),(0,r.jsx)("button",{className:"tab-error-close",onClick:()=>n(null),children:"×"})]}),(0,r.jsx)(h,{tabs:o,activeTab:s,setActiveTab:e=>{try{t(e),n(null)}catch(e){console.error("切换标签页出错:",e),n(`切换标签页出错: ${e.message}`)}},className:"drawing-tabs"})]})};class _ extends a.Component{constructor(e){super(e),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("组件错误:",e,t),this.setState({errorInfo:t})}tryAgain=()=>{this.setState({hasError:!1,error:null,errorInfo:null})};render(){const{children:e,fallback:t,componentName:s="组件"}=this.props,{hasError:a,error:i}=this.state;return a?t?t(i,this.tryAgain):(0,r.jsx)("div",{className:"error-boundary",children:(0,r.jsxs)("div",{className:"error-container",children:[(0,r.jsxs)("h3",{children:[s,"出错了"]}),(0,r.jsx)("p",{className:"error-message",children:i&&i.toString()}),(0,r.jsx)("button",{className:"error-retry",onClick:this.tryAgain,children:"重试"})]})}):e}}const D=_;const C=function(){const{state:e,dispatch:t,actionTypes:s}=(0,i.oi)(),l=(0,a.useRef)(null),{handleGenerateButtonClick:n}=(0,v.A)();(0,a.useEffect)((()=>{const e=e=>{t({type:s.TOGGLE_SETTINGS,value:void 0===e.detail||e.detail})},a=e=>{const a=e.detail&&e.detail.prompt,i=e.detail&&e.detail.originalPrompt;a?t({type:s.SET_PROMPT,value:a,originalPrompt:i||a}):i&&t({type:s.SET_PROMPT,value:"",originalPrompt:i}),t({type:s.TOGGLE_SETTINGS,value:!0}),t({type:s.SET_ACTIVE_TAB,value:"generate"})},i=async e=>{const a=e.detail&&e.detail.prompt;a&&t({type:s.SET_PROMPT,value:a}),await n()};return document.addEventListener("jjdd_huatu_toggle_settings",e),document.addEventListener("jjdd_huatu_generate",a),document.addEventListener("jjdd_huatu_generate_direct",i),()=>{document.removeEventListener("jjdd_huatu_toggle_settings",e),document.removeEventListener("jjdd_huatu_generate",a),document.removeEventListener("jjdd_huatu_generate_direct",i)}}),[t,s,n]);const c=()=>{t({type:s.TOGGLE_SETTINGS,value:!1})},d=e=>{e.stopPropagation(),t({type:s.TOGGLE_SETTINGS,value:!1})};return e.showSettings?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"modal-overlay",onClick:d,onTouchStart:d,style:{position:"fixed",top:0,left:0,right:0,bottom:0,width:"100vw",height:"100vh",backgroundColor:"rgba(0,0,0,0.5)",zIndex:999,touchAction:"auto"}}),(0,r.jsxs)("div",{id:"drawing-settings-container",className:"ht-body",ref:l,onClick:e=>e.stopPropagation(),onTouchStart:e=>e.stopPropagation(),children:[(0,r.jsx)("button",{className:"close-button",title:"关闭",onClick:c,children:"×"}),(0,r.jsx)(D,{componentName:"标题栏",fallback:(e,t)=>(0,r.jsxs)("div",{className:"header-error",children:[(0,r.jsx)("span",{className:"error-message",children:"标题栏加载失败"}),(0,r.jsx)("button",{onClick:t,children:"重试"})]}),children:(0,r.jsx)(o,{})}),(0,r.jsx)(D,{componentName:"标签页系统",fallback:(e,t)=>(0,r.jsxs)("div",{className:"drawing-panel-error",children:[(0,r.jsx)("h3",{children:"画图面板出错"}),(0,r.jsx)("p",{children:e&&e.toString()}),(0,r.jsxs)("div",{className:"error-actions",children:[(0,r.jsx)("button",{onClick:t,children:"重试"}),(0,r.jsx)("button",{onClick:c,children:"关闭面板"})]})]}),children:(0,r.jsx)(A,{})})]})]}):null}}}]);